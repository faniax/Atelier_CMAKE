name: Automatisation des tests
on: push
jobs:
  Compilation:
    runs-on: ubuntu-latest
    steps:
      - name: Compilation
        run: |
          last_directory=$(basename ${{ runner.workspace }})
          git clone https://github.com/${{ github.repository }}.git
          cd ./$last_directory
          mkdir build
          cd build
          cmake ..
          make
          make test

Test_Car:
  runs-on: ubuntu-latest
  needs: Compilation
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Run test "car" and capture report
      run: |
        cd build
        echo '== Test car 5 ==' > report_car.txt
        ./calculator car 5 > output_car.txt
        exit_code=$?
        cat output_car.txt >> report_car.txt
        echo "" >> report_car.txt
        echo "Exit code: $exit_code" >> report_car.txt

    - name: Upload report as artifact
      uses: actions/upload-artifact@v4
      with:
        name: test-car-report
        path: build/report_car.txt
          
